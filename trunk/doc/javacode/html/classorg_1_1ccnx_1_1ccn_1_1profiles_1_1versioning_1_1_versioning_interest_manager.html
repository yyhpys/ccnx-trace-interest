<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Content-Centric Networking in Java: org.ccnx.ccn.profiles.versioning.VersioningInterestManager Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><b>org</b>.<b>ccnx</b>.<b>ccn</b>.<b>profiles</b>.<b>versioning</b>.<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_versioning_interest_manager.html">VersioningInterestManager</a>
  </div>
</div>
<div class="contents">
<h1>org.ccnx.ccn.profiles.versioning.VersioningInterestManager Class Reference</h1><!-- doxytag: class="org::ccnx::ccn::profiles::versioning::VersioningInterestManager" --><!-- doxytag: inherits="org::ccnx::ccn::CCNInterestListener,org::ccnx::ccn::impl::CCNStats::CCNStatistics" -->Manage splitting interests and generating interests for a single base name.  
<a href="#_details">More...</a>
<p>
<div class="dynheader">
Inheritance diagram for org.ccnx.ccn.profiles.versioning.VersioningInterestManager:</div>
<div class="dynsection">

<p><center><img src="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_versioning_interest_manager.png" usemap="#org.ccnx.ccn.profiles.versioning.VersioningInterestManager_map" border="0" alt=""></center>
<map name="org.ccnx.ccn.profiles.versioning.VersioningInterestManager_map">
<area href="interfaceorg_1_1ccnx_1_1ccn_1_1_c_c_n_interest_listener.html" alt="org.ccnx.ccn.CCNInterestListener" shape="rect" coords="0,0,353,24">
</map>
</div>

<p>
<a href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_versioning_interest_manager-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><b>StatsEnum</b> { <br>
&nbsp;&nbsp;<b>Puts</b> = ("ContentObjects", "The number of put calls"), 
<b>Gets</b> = ("ContentObjects", "The number of get calls"), 
<b>WriteInterest</b> = ("calls", "The number of calls to write(Interest)"), 
<b>WriteObject</b> = ("calls", "The number of calls to write(ContentObject)"), 
<br>
&nbsp;&nbsp;<b>WriteErrors</b> = ("count", "Error count for writeInner()"), 
<b>WriteUnderflows</b> = ("count", "The count of times when the bytes written to the channel &lt; buffer size"), 
<b>ExpressInterest</b> = ("calls", "The number of calls to expressInterest"), 
<b>CancelInterest</b> = ("calls", "The number of calls to cancelInterest"), 
<br>
&nbsp;&nbsp;<b>DeliverInterest</b> = ("calls", "The number of calls to deliverInterest"), 
<b>DeliverContent</b> = ("calls", "The number of calls to cancelInterest"), 
<b>DeliverContentMatchingInterests</b> = ("calls", "Count of the calls to threadpool.execute in handleData()"), 
<b>DeliverContentFailed</b> = ("calls", "The number of content deliveries that failed"), 
<br>
&nbsp;&nbsp;<b>DeliverInterestFailed</b> = ("calls", "The number of interest deliveries that failed"), 
<b>ReceiveObject</b> = ("objects", "Receive count of ContentObjects from channel"), 
<b>ReceiveInterest</b> = ("interests", "Receive count of Interests from channel"), 
<b>ReceiveUnknown</b> = ("calls", "Receive count of unknown type from channel"), 
<br>
&nbsp;&nbsp;<b>ReceiveErrors</b> = ("errors", "Number of errors from the channel in run() loop"), 
<b>ContentObjectsIgnored</b> = ("ContentObjects", "The number of ContentObjects that are never handled"), 
<b>HandleInterest</b> = ("interests", "Number of calls to RepositoryInterestHandler.handleInterest()"), 
<b>HandleInterestErrors</b> = ("errors", "Errors in handleInterest()"), 
<br>
&nbsp;&nbsp;<b>HandleInterestCommands</b> = ("interests", "Number of command interests to handleInterest()"), 
<b>HandleInterestStartWriteReceived</b> = ("interests", "Number of start writes to handleInterest()"), 
<b>HandleInterestStartWriteProcessed</b> = ("interests", "Number of start writes processed by handleInterest()"), 
<b>HandleInterestStartWriteIgnored</b> = ("interests", "Number of start writes ignored in handleInterest()"), 
<br>
&nbsp;&nbsp;<b>HandleInterestStartWriteErrors</b> = ("errors", "Error count in startWrite()"), 
<b>HandleInterestNameEnumReceived</b> = ("interests", "Number of name enums to handleInterest()"), 
<b>HandleInterestNameEnumProcessed</b> = ("interests", "Number of name enums processed in handleInterest()"), 
<b>HandleInterestNameEnumIgnored</b> = ("interests", "Number of name enums ignored in handleInterest()"), 
<br>
&nbsp;&nbsp;<b>HandleInterestCheckedWriteReceived</b> = ("interests", "Number of checked write to handleInterest()"), 
<b>HandleInterestCheckedWriteProcessed</b> = ("interests", "Number of checked write processed in handleInterest()"), 
<b>HandleInterestCheckedWriteIgnored</b> = ("interests", "Number of checked write ignored in handleInterest()"), 
<b>HandleInterestBulkImportReceived</b> = ("interests", "Number of bulk imports to handleInterest()"), 
<br>
&nbsp;&nbsp;<b>HandleInterestBulkImportProcessed</b> = ("interests", "Number of bulk imports processed in handleInterest()"), 
<b>HandleInterestBulkImportIgnored</b> = ("interests", "Number of bulk imports ignored in handleInterest()"), 
<b>HandleInterestUncategorized</b> = ("interests", "Number of uncategorized interests to handleInterest()"), 
<b>HandleInterestDuplicateRequests</b> = ("interests", "Number of duplicate interests to handleInterest()"), 
<br>
&nbsp;&nbsp;<b>HandleInterestWriteSuspended</b> = ("interests", "Number of write suspended interests to handleInterest()"), 
<b>HandleInterestStartWritePolicyHandlers</b> = ("responses", "Number of RepositoryPolicyHandler created for StartWrite"), 
<b>HandleInterestStartWriteExpressInterest</b> = ("responses", "Number of expressInterests created for StartWrite"), 
<b>HandleInterestNameEnumResponses</b> = ("responses", "Number of responses sent for Name Enums"), 
<br>
&nbsp;&nbsp;<b>HandleContent</b> = ("objects", "Calls to ResponsitoryDataListener.handleContent()"), 
<b>HandleContentHandleData</b> = ("objects", "Calls to handleData in RepositoryDataListener"), 
<b>HandleContentExpressInterest</b> = ("interests", "Number of interests expressed in handleContent()"), 
<b>HandleContentCancelInterest</b> = ("interests", "Number of interests cancelled"), 
<br>
&nbsp;&nbsp;<b>HandleContentExpressInterestErrors</b> = ("errors", "Number of errors expressing interests in handleContent()"), 
<b>Receive</b> = ("ContentObjects", "The number of objects received in handleContent"), 
<b>ReceiveVersionNumberError</b> = ("Errors", "Errors parsing VersionNumber from content name"), 
<b>ReceiveReturnInterest</b> = ("interests", "Number of non-null interests returned from receive()"), 
<br>
&nbsp;&nbsp;<b>ReceiveIgnored</b> = ("count", "Count of objects ignored because version was out-of-bounds"), 
<b>ReceiveDuplicates</b> = ("count", "Count of duplicate version numbers received"), 
<b>ReceiveUnique</b> = ("count", "Count of objects with unique version numbers received"), 
<b>ReceiveNoPendingInterest</b> = ("Errors", "Received object did not match a pending interest in _interestMap"), 
<br>
&nbsp;&nbsp;<b>Rebuild</b> = ("count", "Calls to rebuild()"), 
<b>RebuileShiftLeft</b> = ("count", "Number of left-shift rebuilds"), 
<b>RebuildShiftRight</b> = ("count", "Number of right-shift rebuilds"), 
<b>RebuildCreateLeft</b> = ("count", "Number of create left neighbor rebuilds"), 
<br>
&nbsp;&nbsp;<b>RebuildCreateRight</b> = ("count", "Number of create right neighbor rebuilds"), 
<b>RebuildInsertLeft</b> = ("count", "Number of inserts to left rebuilds"), 
<b>RebuildInsertRight</b> = ("count", "Number of inserts to right rebuilds"), 
<b>RebuildRollLeft</b> = ("count", "Number of roll left rebuilds"), 
<br>
&nbsp;&nbsp;<b>RebuildRollRight</b> = ("count", "Number of roll right rebuilds"), 
<b>SendInterest</b> = ("count", "Interests sent (not counting ReceiveReturnInterest)"), 
<b>CancelInterest</b> = ("count", "Interests cancelled"), 
<b>SendInterestErrors</b> = ("errors", "Errors calling expressInterest()")
<br>
 }</td></tr>

<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_versioning_interest_manager.html#3a0f337681f9507e2b1428cc0b2d9a1e">VersioningInterestManager</a> (<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1_c_c_n_handle.html">CCNHandle</a> handle, <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_content_name.html">ContentName</a> name, Set&lt; <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_version_number.html">VersionNumber</a> &gt; exclusions, <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_version_number.html">VersionNumber</a> startingVersion, <a class="el" href="interfaceorg_1_1ccnx_1_1ccn_1_1_c_c_n_interest_listener.html">CCNInterestListener</a> listener)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_versioning_interest_manager.html" title="Manage splitting interests and generating interests for a single base name.">VersioningInterestManager</a> for a specific content name.  <a href="#3a0f337681f9507e2b1428cc0b2d9a1e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">synchronized void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_versioning_interest_manager.html#49be3e59af8ba9324f761b3418e70628">start</a> ()  throws IOException </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generate interests and return data to the listener.  <a href="#49be3e59af8ba9324f761b3418e70628"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="268760d82649e4dca9e90beae2538112"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::stop" ref="268760d82649e4dca9e90beae2538112" args="()" -->
synchronized void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_versioning_interest_manager.html#268760d82649e4dca9e90beae2538112">stop</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">cancel all interests and stop operation <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_interest.html">Interest</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_versioning_interest_manager.html#859efb726661b4525873200a32d21feb">handleContent</a> (<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_content_object.html">ContentObject</a> data, <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_interest.html">Interest</a> interest)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Callback called when we get new results for our query.  <a href="#859efb726661b4525873200a32d21feb"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="4624487f8c34393a62317f93d17f03fa"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::dumpExcluded" ref="4624487f8c34393a62317f93d17f03fa" args="()" -->
String&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_versioning_interest_manager.html#4624487f8c34393a62317f93d17f03fa">dumpExcluded</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This is purely a debugging aid. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="21ca85bc69ad3503cf158f0e518af745"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::getStats" ref="21ca85bc69ad3503cf158f0e518af745" args="()" -->
<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1_c_c_n_stats.html">CCNStats</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>getStats</b> ()</td></tr>

<tr><td colspan="2"><br><h2>Static Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="3dcc4f3fae7b30388f87cccf7f42dcd2"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::MIN_FILL" ref="3dcc4f3fae7b30388f87cccf7f42dcd2" args="" -->
static final int&nbsp;</td><td class="memItemRight" valign="bottom"><b>MIN_FILL</b> = 50</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="f2f7f9cd643d9de9dd746665e44b08ce"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::MID_FILL" ref="f2f7f9cd643d9de9dd746665e44b08ce" args="" -->
static final int&nbsp;</td><td class="memItemRight" valign="bottom"><b>MID_FILL</b> = 125</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="ab599b35a2a61a9fe82d6027d4136b4e"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::MAX_FILL" ref="ab599b35a2a61a9fe82d6027d4136b4e" args="" -->
static final int&nbsp;</td><td class="memItemRight" valign="bottom"><b>MAX_FILL</b> = 200</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_interest.html">Interest</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_versioning_interest_manager.html#bd655aff4cab3f79366c6bfccb30fe88">receive</a> (<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_content_object.html">ContentObject</a> data, <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_interest.html">Interest</a> interest)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Called from handleInterest.  <a href="#bd655aff4cab3f79366c6bfccb30fe88"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_versioning_interest_manager.html#b8ea8e61ce956a95b78f47641df6a4d3">rebuild</a> (<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_version_number.html">VersionNumber</a> version, <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html">InterestData</a> datum)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">We received a new version and tried to add it to the given datum, but that datum is too full.  <a href="#b8ea8e61ce956a95b78f47641df6a4d3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_versioning_interest_manager.html#7c954882b8558dcacd75eb4a77d2cf2e">sendInterest</a> (<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html">InterestData</a> id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send a new interest and manage the _interestMap.  <a href="#7c954882b8558dcacd75eb4a77d2cf2e"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="4c0f1199ff5c94c77cd6f80d1df275b9"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::_handle" ref="4c0f1199ff5c94c77cd6f80d1df275b9" args="" -->
final <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1_c_c_n_handle.html">CCNHandle</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>_handle</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="47c9f0c31a17cef079202425d3adee33"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::_dataLock" ref="47c9f0c31a17cef079202425d3adee33" args="" -->
final Object&nbsp;</td><td class="memItemRight" valign="bottom"><b>_dataLock</b> = new Object()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="35d3370d4ea87295bb6788211476f370"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::_exclusions" ref="35d3370d4ea87295bb6788211476f370" args="" -->
final TreeSet6&lt; <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_version_number.html">VersionNumber</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>_exclusions</b> = new TreeSet6&lt;<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_version_number.html">VersionNumber</a>&gt;()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="c615f66aafe3d47ac74d4867ac4390fc"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::_interestData" ref="c615f66aafe3d47ac74d4867ac4390fc" args="" -->
final TreeSet6&lt; <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html">InterestData</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>_interestData</b> = new TreeSet6&lt;<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html">InterestData</a>&gt;(new InterestData.StartTimeComparator())</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="c8528eb6fff2f3cb32f657949330f98a"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::_interestMap" ref="c8528eb6fff2f3cb32f657949330f98a" args="" -->
final Map&lt; <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_interest.html">Interest</a>, <br>
InterestMapData &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>_interestMap</b> = new HashMap&lt;<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_interest.html">Interest</a>, InterestMapData&gt;()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="3d91983333dd1e6cb56db5f620444275"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::_stats" ref="3d91983333dd1e6cb56db5f620444275" args="" -->
CCNEnumStats&lt; StatsEnum &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>_stats</b> = new CCNEnumStats&lt;StatsEnum&gt;(StatsEnum.Receive)</td></tr>

<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><b>InterestMapData</b></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Manage splitting interests and generating interests for a single base name. 
<p>
This class is used by <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_versioning_interest.html" title="Given a base name, retrieve all versions.">VersioningInterest</a>, and should not be used stand-alone.<p>
Current interest filling algorithm: Interests are filled to MIN_FULL exclusions initially and allowed to grow to MAX_FULL exclusions. When MAX_FULL exclusions is reached, the starting times are re-arranged.<p>
This operates by maintaining a set of interests from [startingVersion, infinity). Initially, we issue one interest I_0[startingVersion, infinity). When that interest fills, it is split in to two interests, and it is split to the left: I_-1[startingVersion, k], I_0[k+1, infinity), where "k" is picked to keep MIN_FILL in the right member (I_0).<p>
"infinity" is really the maximum version component, so it is well-defined.<p>
At some point, we will have a series of interests: I0[startingVersion, k0], I1[k0+1, k1], I2[k1+1, k2], I3[k2+1, k3], I4[k3+1, infinity)<p>
Algorithm:<ul>
<li>This algorithm is biased towards shifting to the left, because we fill from the right. Based on usage experience, we may want to change this filling algorithm.</li><li>The density of an <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html" title="Stores state about a specific Interest on the wire.">InterestData</a> is defined as (# exclusions) / (stop - start). Seemed like a good idea at the time, but might want to drop this concept and just use the # of exclusions.</li><li>We track the average density of all intervals and use that to decide if we should rebalance by shifing or add a new interest.</li></ul>
<p>
<ul>
<li>When we receive an interest, find the corresponding <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html" title="Stores state about a specific Interest on the wire.">InterestData</a> that contains the version number. A) If that <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html" title="Stores state about a specific Interest on the wire.">InterestData</a> is not full (under MAX_FILL), then add the exclusion to that <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html" title="Stores state about a specific Interest on the wire.">InterestData</a> and re-express an Interest from that <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html" title="Stores state about a specific Interest on the wire.">InterestData</a> via the handleContent return value. Done.</li><li>The <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html" title="Stores state about a specific Interest on the wire.">InterestData</a> is full. B) Pick the left or right neighbor that is least full, if such a neighbor exists, and is under MID_FILL. If equally filled, pick the left.<ul>
<li>If picked left, transfer exclusions from the head to the left neighbor and then adjust the start &amp; stop values. Fill it up to MID_FILL.</li><li>If picked right, transfer exclusions from the tail to the right neighbor and then adjust the start &amp; stop values. Fill it up to MID_FILL.</li><li>Issue a new interest for the picked neighbor, then the current <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html" title="Stores state about a specific Interest on the wire.">InterestData</a> returns a new interest to handleContent. These both replace the entries in _interestMap, so if we receive content for an old outstanding interest, no match is found and no "extra" interest will be generated from that.</li><li>done C) If the left or right neighbor does not exist, create it. If both are missing, pick the left.</li></ul>
</li></ul>
<p>
Let the current <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html" title="Stores state about a specific Interest on the wire.">InterestData</a> be M[a, b].<ul>
<li>If left, create L[a, k] M[k, b] by transferring MIN_FILL elements</li><li>If right, create M[a, k] R[k, b] by transferring MID_FILL elements</li><li>Send a new interest for the new <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html" title="Stores state about a specific Interest on the wire.">InterestData</a></li><li>Return a new interest to handleContent for M. D) If both the L and R neighbors are at MID_FILL or more, then we want to re-balance the intervals. 1) If the density of each of (L, M, R) is above average, insert a new interest. Pick L or R based on the higher density of the neighbor. If equal, pick left. Transfer MIN_FILL from M and the chosen side to the new interest. Send a new interest message from the new interest and from the chosen neighbor, then return a new interest from M to handleContent 2) Otherwise, rebalance. Pick the denser side, and recursively shift that direction until the last node is under MID_FILL, or we are at the terminus and create a new interest. Then balance current node and neighbor. Issue a new interest message for each modified or created <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html" title="Stores state about a specific Interest on the wire.">InterestData</a>, then return interest to handleContent for current interestdata. </li></ul>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="3a0f337681f9507e2b1428cc0b2d9a1e"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::VersioningInterestManager" ref="3a0f337681f9507e2b1428cc0b2d9a1e" args="(CCNHandle handle, ContentName name, Set&lt; VersionNumber &gt; exclusions, VersionNumber startingVersion, CCNInterestListener listener)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">org.ccnx.ccn.profiles.versioning.VersioningInterestManager.VersioningInterestManager           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1_c_c_n_handle.html">CCNHandle</a>&nbsp;</td>
          <td class="paramname"> <em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_content_name.html">ContentName</a>&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Set&lt; <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_version_number.html">VersionNumber</a> &gt;&nbsp;</td>
          <td class="paramname"> <em>exclusions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_version_number.html">VersionNumber</a>&nbsp;</td>
          <td class="paramname"> <em>startingVersion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="interfaceorg_1_1ccnx_1_1ccn_1_1_c_c_n_interest_listener.html">CCNInterestListener</a>&nbsp;</td>
          <td class="paramname"> <em>listener</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create a <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_versioning_interest_manager.html" title="Manage splitting interests and generating interests for a single base name.">VersioningInterestManager</a> for a specific content name. 
<p>
Send results to the listener.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>handle</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exclusions</em>&nbsp;</td><td>may be null or empty </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>startingVersion</em>&nbsp;</td><td>non-negative, use 0 for all versions </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>listener</em>&nbsp;</td><td></td></tr>
  </table>
</dl>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="49be3e59af8ba9324f761b3418e70628"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::start" ref="49be3e59af8ba9324f761b3418e70628" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">synchronized void org.ccnx.ccn.profiles.versioning.VersioningInterestManager.start           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td>  throws IOException </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Generate interests and return data to the listener. 
<p>
<dl compact><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>IOException</em>&nbsp;</td><td></td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="859efb726661b4525873200a32d21feb"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::handleContent" ref="859efb726661b4525873200a32d21feb" args="(ContentObject data, Interest interest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_interest.html">Interest</a> org.ccnx.ccn.profiles.versioning.VersioningInterestManager.handleContent           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_content_object.html">ContentObject</a>&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_interest.html">Interest</a>&nbsp;</td>
          <td class="paramname"> <em>interest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Callback called when we get new results for our query. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>the ContentObject that matched our Interest </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>interest</em>&nbsp;</td><td>Interest that was satisfied </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>new Interest to be expressed </dd></dl>

<p>Implements <a class="el" href="interfaceorg_1_1ccnx_1_1ccn_1_1_c_c_n_interest_listener.html#9dff8eaa65f047bd74f4f1cc0da9c454">org.ccnx.ccn.CCNInterestListener</a>.</p>

</div>
</div><p>
<a class="anchor" name="bd655aff4cab3f79366c6bfccb30fe88"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::receive" ref="bd655aff4cab3f79366c6bfccb30fe88" args="(ContentObject data, Interest interest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_interest.html">Interest</a> org.ccnx.ccn.profiles.versioning.VersioningInterestManager.receive           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_content_object.html">ContentObject</a>&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_interest.html">Interest</a>&nbsp;</td>
          <td class="paramname"> <em>interest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Called from handleInterest. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>interest</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd></dd></dl>

</div>
</div><p>
<a class="anchor" name="b8ea8e61ce956a95b78f47641df6a4d3"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::rebuild" ref="b8ea8e61ce956a95b78f47641df6a4d3" args="(VersionNumber version, InterestData datum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void org.ccnx.ccn.profiles.versioning.VersioningInterestManager.rebuild           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_version_number.html">VersionNumber</a>&nbsp;</td>
          <td class="paramname"> <em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html">InterestData</a>&nbsp;</td>
          <td class="paramname"> <em>datum</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
We received a new version and tried to add it to the given datum, but that datum is too full. 
<p>
we need to split the interest.<p>
The strategy we use is to keep shifting left. If there is no interest to the left of datum, make one. If there is and it's full, rebuild it, then add our exclusion to the left.<p>
handleContent is synchronized, and the only path to rebuild is from there, so we don't worry about locking too much.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>datum</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>version</em>&nbsp;</td><td>may be null for a rebuild w/o insert </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="7c954882b8558dcacd75eb4a77d2cf2e"></a><!-- doxytag: member="org::ccnx::ccn::profiles::versioning::VersioningInterestManager::sendInterest" ref="7c954882b8558dcacd75eb4a77d2cf2e" args="(InterestData id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void org.ccnx.ccn.profiles.versioning.VersioningInterestManager.sendInterest           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html">InterestData</a>&nbsp;</td>
          <td class="paramname"> <em>id</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send a new interest and manage the _interestMap. 
<p>
If the <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1profiles_1_1versioning_1_1_interest_data.html" title="Stores state about a specific Interest on the wire.">InterestData</a> has an old interest, we set the reexpress flag to false it in the map, so it will no longer cause a new interest to be sent and then add the new interest to the map, so when we receive an object for it, we'll issue a new interest. 
</div>
</div><p>
<hr>The documentation for this class was generated from the following file:<ul>
<li>src/org/ccnx/ccn/profiles/versioning/VersioningInterestManager.java</ul>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Sep 14 12:44:31 2011 for Content-Centric Networking in Java by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
